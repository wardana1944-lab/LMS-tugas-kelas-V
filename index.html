<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RUANG BELAJAR - SDN PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* CSS & Tampilan Utama */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; padding: 15px; color: #f8fafc; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    /* Header & Identitas */
    .header-main { text-align: center; margin-bottom: 25px; }
    .identity-row { display: flex; gap: 10px; margin-bottom: 20px; }
    .identitas-box, .guru-profile-box { flex: 1; background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px solid rgba(56,189,248,0.2); display: flex; align-items: center; gap: 10px; }
    .img-identitas, .foto-guru { width: 45px; height: 45px; object-fit: cover; }
    .foto-guru { border-radius: 50%; border: 2px solid #38bdf8; }
    .text-utama { font-weight: bold; color: #38bdf8; font-size: 0.75rem; }

    /* Dashboard Guru */
    #halamanGuru { display: none; background: #ffffff; color: #1e293b; border-radius: 20px; padding: 20px; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .tab-link { cursor: pointer; padding: 8px 15px; border-radius: 8px; background: #e2e8f0; font-weight: bold; font-size: 0.8rem; }
    .tab-link.active { background: #38bdf8; color: white; }
    .panel { display: none; }
    .panel.active { display: block; }

    /* Form & Input */
    input, textarea, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }
    .btn { padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
    .btn-primary { background: #38bdf8; color: #0f172a; }
    .btn-success { background: #10b981; color: white; }

    /* Area Ujian Siswa */
    #areaUjian { display: none; background: white; color: #1e293b; padding: 20px; border-radius: 20px; margin-top: 10px; }
    .soal-item { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    
    /* Sertifikat/Hasil yang akan di-download */
    #hasilSiswa { display: none; background: #f8fafc; padding: 30px; border-radius: 15px; border: 5px solid #38bdf8; text-align: center; color: #1e293b; }
    
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; }
    .student-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; }
  </style>
</head>
<body>

<div class="container">
  <div id="halamanDepan">
    <div class="header-main">
      <h1 style="color:#38bdf8">RUANG BELAJAR</h1>
      <div class="identity-row">
          <div class="identitas-box">
              <img src="logo-putih.png" class="img-identitas">
              <div><p class="text-utama">SDN Pengkol</p></div>
          </div>
          <div class="guru-profile-box" onclick="bukaSandi()">
              <img src="foto-guru.webp" class="foto-guru">
              <div class="guru-info"><p class="text-utama">Aditya W. W.</p></div>
          </div>
      </div>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <div id="areaUjian">
    <h2 id="judulUjianSiswa" style="margin-bottom: 20px;"></h2>
    <div id="kontenSoal"></div>
    <button class="btn btn-success" onclick="akhiriUjian()">AKHIRI & SIMPAN NILAI</button>
  </div>

  <div id="hasilSiswa">
    <img src="logo-putih.png" style="width: 60px; filter: invert(1);"><br><br>
    <h3>HASIL TUGAS MANDIRI</h3>
    <h1 id="nilaiAngka" style="font-size: 4rem; color: #38bdf8; margin: 10px 0;">0</h1>
    <p id="namaSiswaHasil" style="font-weight: bold;"></p>
    <p id="tglHasil"></p>
    <div id="rekapUraian" style="text-align: left; font-size: 0.8rem; margin-top: 15px; border-top: 1px solid #ccc; padding-top: 10px; display: none;"></div>
    <br>
    <button class="btn btn-primary" onclick="downloadHasil()">ðŸ’¾ SIMPAN KE GALERI (JPG)</button>
  </div>

  <div id="halamanGuru">
    <h2>ðŸ“Š Dashboard Guru</h2><br>
    <div class="tabs">
        <div class="tab-link active" onclick="openTab(event, 'tabBuat')">ðŸ›  Buat Soal</div>
        <div class="tab-link" onclick="openTab(event, 'tabRekap')">ðŸ“‹ Rekap Nilai</div>
    </div>

    <div id="tabBuat" class="panel active">
        <label>Judul Tugas:</label>
        <input type="text" id="judulTugas" placeholder="Misal: UH IPAS Bab 1">
        
        <label>Jenis Soal:</label>
        <select id="jenisSoal" onchange="toggleInputSoal()">
            <option value="pg">Pilihan Ganda (Otomatis Nilai)</option>
            <option value="uraian">Uraian (Rekap Jawaban)</option>
        </select>

        <div id="areaEditorSoal">
            <textarea id="inputSoal" rows="5" placeholder="Tulis soal di sini..."></textarea>
            <div id="opsiPG">
                <input type="text" id="pg_a" placeholder="Pilihan A">
                <input type="text" id="pg_b" placeholder="Pilihan B">
                <input type="text" id="pg_c" placeholder="Pilihan C">
                <input type="text" id="pg_d" placeholder="Pilihan D">
                <label>Kunci Jawaban:</label>
                <select id="pg_kunci"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select>
            </div>
        </div>
        <button class="btn btn-primary" onclick="publishTugas()">PUBLIKASIKAN TUGAS</button>
    </div>
  </div>
</div>

<div id="modalLogin" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999; align-items:center; justify-content:center;">
    <div style="background:white; padding:20px; border-radius:15px; width:280px;">
        <input type="password" id="passInput" placeholder="Sandi Guru">
        <button class="btn btn-primary" onclick="loginGuru()">Masuk</button>
    </div>
</div>

<script>
    let dbTugas = { judul: "", jenis: "", soal: "", kunci: "", opsi: [] };
    let userSekarang = "";

    // Inisialisasi Data Siswa
    const SISWA = ["Alvaro", "Anantha", "Arifah", "Aurelia", "Dhafitha", "Dhian", "Dimas", "Erfin", "Marsya", "Mikayla", "Ozil", "Rhevan", "Ridho", "Rizky", "Tanca"];
    const grid = document.getElementById('cardsGrid');
    SISWA.forEach(s => {
        grid.innerHTML += `<div class="student-card" onclick="mulaiUjian('${s}')">ðŸ‘¤<br>${s}</div>`;
    });

    function toggleInputSoal() {
        document.getElementById('opsiPG').style.display = document.getElementById('jenisSoal').value === 'pg' ? 'block' : 'none';
    }

    function publishTugas() {
        dbTugas = {
            judul: document.getElementById('judulTugas').value,
            jenis: document.getElementById('jenisSoal').value,
            soal: document.getElementById('inputSoal').value,
            kunci: document.getElementById('pg_kunci').value,
            opsi: [document.getElementById('pg_a').value, document.getElementById('pg_b').value, document.getElementById('pg_c').value, document.getElementById('pg_d').value]
        };
        alert("Tugas Berhasil Dipublikasikan!");
        location.reload();
    }

    function mulaiUjian(nama) {
        if(!dbTugas.judul) return alert("Belum ada tugas dari Guru!");
        userSekarang = nama;
        document.getElementById('halamanDepan').style.display = 'none';
        document.getElementById('areaUjian').style.display = 'block';
        document.getElementById('judulUjianSiswa').innerText = dbTugas.judul;
        
        let html = `<div class="soal-item"><p>${dbTugas.soal}</p>`;
        if(dbTugas.jenis === 'pg') {
            ['A','B','C','D'].forEach((r, i) => {
                html += `<label><input type="radio" name="jawaban" value="${r}"> ${r}. ${dbTugas.opsi[i]}</label><br>`;
            });
        } else {
            html += `<textarea id="jawabanUraian" rows="4" placeholder="Ketik jawabanmu di sini..."></textarea>`;
        }
        html += `</div>`;
        document.getElementById('kontenSoal').innerHTML = html;
    }

    function akhiriUjian() {
        let skor = 0;
        let rekap = "";
        
        if(dbTugas.jenis === 'pg') {
            let terpilih = document.querySelector('input[name="jawaban"]:checked')?.value;
            skor = (terpilih === dbTugas.kunci) ? 100 : 0;
            document.getElementById('nilaiAngka').innerText = skor;
        } else {
            rekap = document.getElementById('jawabanUraian').value;
            document.getElementById('nilaiAngka').innerText = "SELESAI";
            document.getElementById('rekapUraian').style.display = "block";
            document.getElementById('rekapUraian').innerText = "Jawaban Kamu: " + rekap;
        }

        document.getElementById('areaUjian').style.display = 'none';
        document.getElementById('hasilSiswa').style.display = 'block';
        document.getElementById('namaSiswaHasil').innerText = userSekarang;
        document.getElementById('tglHasil').innerText = new Date().toLocaleString();
    }

    function downloadHasil() {
        const target = document.getElementById('hasilSiswa');
        // Menyembunyikan tombol download saat difoto agar tidak ikut masuk gambar
        target.querySelector('button').style.display = 'none';
        
        html2canvas(target).then(canvas => {
            const link = document.createElement('a');
            link.download = `Nilai_${userSekarang}.jpg`;
            link.href = canvas.toDataURL("image/jpeg");
            link.click();
            target.querySelector('button').style.display = 'block';
            alert("Berhasil disimpan ke Galeri!");
        });
    }

    function bukaSandi() { document.getElementById('modalLogin').style.display = 'flex'; }
    function loginGuru() {
        if(document.getElementById('passInput').value === "guru123") {
            document.getElementById('modalLogin').style.display = 'none';
            document.getElementById('halamanDepan').style.display = 'none';
            document.getElementById('halamanGuru').style.display = 'block';
        }
    }
    function openTab(evt, name) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-link').forEach(t => t.classList.remove('active'));
        document.getElementById(name).classList.add('active');
        evt.currentTarget.classList.add('active');
    }
</script>

</body>
</html>
