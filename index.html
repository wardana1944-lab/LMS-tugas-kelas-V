<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruang Belajar - SD NEGERI PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #0ea5e9; --bg: #030712; --glass: rgba(255, 255, 255, 0.03); --border: rgba(255, 255, 255, 0.08); }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: var(--bg); color: #f8fafc; min-height: 100vh; padding: 20px 15px; }
    .container { max-width: 800px; margin: 0 auto; }

    /* HEADER */
    .brand-header { text-align: center; margin-bottom: 30px; }
    .brand-header h1 { font-size: 2.2rem; font-weight: 800; background: linear-gradient(to bottom, #ffffff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 5px; }
    .brand-header p { font-size: 0.8rem; letter-spacing: 3px; color: var(--primary); font-weight: 700; }

    .info-bar { background: var(--glass); border: 1px solid var(--border); padding: 12px 20px; border-radius: 100px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .guru-profile { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .guru-profile img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--primary); }
    .guru-info { text-align: right; }
    .guru-info .nama { font-size: 0.75rem; font-weight: 700; }
    .guru-info .nip { font-size: 0.55rem; color: #94a3b8; font-family: monospace; }

    /* GRID SISWA (3 KOLOM x 5 BARIS) */
    .grid-siswa { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .card-siswa { background: var(--glass); border: 1px solid var(--border); padding: 15px 5px; border-radius: 20px; text-align: center; cursor: pointer; min-height: 140px; display: flex; flex-direction: column; justify-content: center; }
    .card-siswa:hover { border-color: var(--primary); background: rgba(14,165,233,0.1); }
    .card-siswa span { font-size: 2.2rem; display: block; margin-bottom: 8px; }
    .card-siswa p { font-size: 0.65rem; font-weight: 700; color: #cbd5e1; }

    /* OVERLAY */
    .panel-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #030712; z-index: 9999; overflow-y: auto; padding: 25px 15px; }

    /* REKAP TABLE */
    .rekap-box { background: white; border-radius: 20px; color: #1e293b; overflow: hidden; margin-top: 15px; }
    table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
    th { background: #f1f5f9; padding: 12px; text-align: left; font-weight: 800; }
    td { padding: 12px; border-bottom: 1px solid #f1f5f9; }

    .btn-action { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-top: 10px; }
    .bento-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
    .bento-card { background: #111827; border: 1px solid var(--border); padding: 20px; border-radius: 24px; cursor: pointer; text-align: center; }
    input, textarea, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #cbd5e1; margin: 8px 0; }
  </style>
</head>
<body>

<div class="container">
  <div class="brand-header">
    <h1>RUANG BELAJAR</h1>
    <p>SD NEGERI PENGKOL</p>
  </div>
  <div class="info-bar">
    <div style="font-size: 0.65rem; color: #94a3b8;">KELAS V ‚Ä¢ 2025/2026</div>
    <div class="guru-profile" onclick="openLogin()">
      <div class="guru-info">
        <p class="nama">Aditya W. W., S.Pd</p>
        <p class="nip">NIP. 19940319 202321 1 005</p>
      </div>
      <img src="https://ui-avatars.com/api/?name=Aditya+WW&background=0ea5e9&color=fff">
    </div>
  </div>
  <div id="statusTugas" class="banner" style="text-align:center; padding:10px; color:var(--primary); font-weight:bold;">Memuat data...</div>
  <div class="grid-siswa" id="gridSiswa"></div>
</div>

<div id="panelRekap" class="panel-overlay" style="background: #f8fafc; color: #1e293b;">
  <div class="container">
    <h2 style="text-align:center; margin-bottom:15px;">üìä Rekap Nilai Siswa</h2>
    <div class="rekap-box">
      <table>
        <thead>
          <tr><th>No</th><th>Nama</th><th>Nilai</th><th>Bukti</th></tr>
        </thead>
        <tbody id="isiRekapTabel"></tbody>
      </table>
    </div>
    <button class="btn-action" style="background:var(--primary); color:white" onclick="closeView('panelRekap')">KEMBALI</button>
  </div>
</div>

<div id="panelGuru" class="panel-overlay">
  <div class="container" style="max-width: 500px;">
    <h2 style="text-align:center; margin-bottom: 25px;">MENU KONTROL GURU</h2>
    <div class="bento-grid">
      <div class="bento-card" onclick="openView('panelBuat')"><span>üìù</span><h4>Buat Tugas</h4></div>
      <div class="bento-card" onclick="openView('panelRekap')"><span>üìä</span><h4>Rekap Nilai</h4></div>
      <div class="bento-card" style="border-color:#ef4444;" onclick="resetTugas()"><h4 style="color:#ef4444;">Hapus Tugas</h4></div>
      <div class="bento-card" onclick="location.reload()"><h4>Keluar</h4></div>
    </div>
  </div>
</div>

<div id="panelBuat" class="panel-overlay" style="background:#f1f5f9; color:#1e293b;">
  <div class="container" style="max-width:500px;">
    <h3>üìù Setting Tugas Baru</h3>
    <input type="text" id="judulMateri" placeholder="Judul Materi">
    <select id="jenisTugas" onchange="resetFormSoal()">
      <option value="pg">Pilihan Ganda (A-D)</option>
      <option value="uraian">Uraian</option>
    </select>
    <div id="wadahSoal"></div>
    <button class="btn-action" style="background:#94a3b8; color:white" onclick="tambahSoalItem()">+ Tambah Soal</button>
    <button class="btn-action" style="background:var(--primary); color:white" onclick="terbitkanTugas()">TERBITKAN</button>
    <button class="btn-action" style="background:#ef4444; color:white" onclick="closeView('panelBuat')">BATAL</button>
  </div>
</div>

<div id="modalLogin" class="panel-overlay" style="background:rgba(0,0,0,0.9); display:none; align-items:center; justify-content:center;">
  <div style="background:#1f2937; padding:30px; border-radius:24px; width:300px; text-align:center;">
    <h4 style="margin-bottom:20px; color:white;">PIN GURU</h4>
    <input type="password" id="pinInput" placeholder="****" style="text-align:center; font-size:1.5rem; color:white; background:rgba(0,0,0,0.2); border:none;">
    <button class="btn-action" style="background:var(--primary); color:white" onclick="cekLogin()">MASUK</button>
    <button style="background:none; border:none; color:#94a3b8; margin-top:10px;" onclick="closeAllPanels()">Batal</button>
  </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzKSeF0P2w2x1sszm09pLl1lEzApYHH9xbG1UISa5SoiDWfrle5L4iF7jbh8LtdqgyHvA/exec";
const SISWA = [{n:"Alvaro Adnan Aji Pambudi",i:"üë¶"},{n:"Anantha Yudha Diztira",i:"üë¶"},{n:"Arifah Yhuan Nur Azizah",i:"üëß"},{n:"Aurelia Gieni Lindria Putri",i:"üëß"},{n:"Dhafitha Nizza Nur Azizah",i:"üëß"},{n:"Dhian Rahmawati",i:"üëß"},{n:"Dimas Rasyid Faristia",i:"üë¶"},{n:"Erfin Denu Setiawan",i:"üë¶"},{n:"Marsya Anindya Kiera",i:"üëß"},{n:"Mikayla Ayuningtyas",i:"üëß"},{n:"Muhammad Ozil Ramadhan",i:"üë¶"},{n:"Rhevan Nabil Yudanta",i:"üë¶"},{n:"Ridho Wicaksono",i:"üë¶"},{n:"Rizky Syam Dani",i:"üë¶"},{n:"Tanca Al Verosa",i:"üë¶"}];

let dataWeb = null;

window.onload = async () => {
  const grid = document.getElementById('gridSiswa');
  SISWA.forEach(s => { grid.innerHTML += `<div class="card-siswa"><span>${s.i}</span><p>${s.n}</p></div>`; });
  try {
    const res = await fetch(API + "?action=getAllData");
    dataWeb = await res.json();
    document.getElementById('statusTugas').innerText = dataWeb.tugas.judul === "TIDAK ADA TUGAS" ? "BELUM ADA TUGAS AKTIF" : "TUGAS: " + dataWeb.tugas.judul;
  } catch(e) { document.getElementById('statusTugas').innerText = "Gagal Memuat Data"; }
};

function openView(id) {
    document.getElementById(id).style.display = 'block';
    if(id === 'panelRekap') renderRekap();
}
function closeView(id) { document.getElementById(id).style.display = 'none'; }
function closeAllPanels() { document.querySelectorAll('.panel-overlay').forEach(p => p.style.display = 'none'); }

function renderRekap() {
    const tbody = document.getElementById('isiRekapTabel');
    tbody.innerHTML = "";
    if(!dataWeb || !dataWeb.rekap) return;

    SISWA.forEach((s, idx) => {
        // Mencari data yang sesuai nama siswa DAN judul tugas yang sedang aktif
        const r = dataWeb.rekap.find(item => item.nama === s.n && item.materi === dataWeb.tugas.judul);
        tbody.innerHTML += `
            <tr>
                <td>${idx + 1}</td>
                <td><b>${s.n}</b></td>
                <td style="color:var(--primary); font-weight:800;">${r ? r.nilai : '-'}</td>
                <td>${r ? `<a href="https://drive.google.com/uc?id=${r.link}" target="_blank" style="color:green; text-decoration:none; font-weight:bold;">LIHAT</a>` : '<span style="color:#ccc">Belum</span>'}</td>
            </tr>`;
    });
}

function openLogin() { document.getElementById('modalLogin').style.display = 'flex'; }
function cekLogin() { if(document.getElementById('pinInput').value === "1234") { closeAllPanels(); openView('panelGuru'); } else alert("PIN SALAH!"); }

function tambahSoalItem() {
  const tipe = document.getElementById('jenisTugas').value;
  const html = `<div style="background:white; padding:15px; border-radius:10px; margin-bottom:10px; border:1px solid #ddd;">
      <b>Soal:</b><textarea class="q-tanya"></textarea>
      ${tipe === 'pg' ? `<div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;"><input class="oa" placeholder="A"><input class="ob" placeholder="B"><input class="oc" placeholder="C"><input class="od" placeholder="D"></div>
      <b>Kunci:</b><select class="q-kunci"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select>` : ''}
      </div>`;
  document.getElementById('wadahSoal').insertAdjacentHTML('beforeend', html);
}
function resetFormSoal() { document.getElementById('wadahSoal').innerHTML = ""; tambahSoalItem(); }

async function terbitkanTugas() {
  const p = { action: "setTugas", judul: document.getElementById('judulMateri').value, jenis: document.getElementById('jenisTugas').value, soal: [] };
  document.querySelectorAll('#wadahSoal > div').forEach(el => {
    let s = { tanya: el.querySelector('.q-tanya').value };
    if(p.jenis === 'pg') {
      s.opsi = [el.querySelector('.oa').value, el.querySelector('.ob').value, el.querySelector('.oc').value, el.querySelector('.od').value];
      s.kunci = el.querySelector('.q-kunci').value;
    }
    p.soal.push(s);
  });
  await fetch(API, { method: "POST", body: JSON.stringify(p) });
  alert("Tugas Terbit!"); location.reload();
}
</script>
</body>
</html>
