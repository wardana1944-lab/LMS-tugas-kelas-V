<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ruang Belajar - SD NEGERI PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary: #2563eb; --bg: #ffffff; --text: #0f172a; --border: #e2e8f0; }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: var(--bg); color: var(--text); padding: 20px 15px; }
    .container { max-width: 800px; margin: 0 auto; }
    
    .brand-header { text-align: center; margin-bottom: 30px; }
    .brand-header h1 { font-size: 2rem; font-weight: 800; }
    .brand-header p { font-size: 0.8rem; letter-spacing: 2px; color: var(--primary); font-weight: 700; text-transform: uppercase; }
    
    .info-bar { background: #f8fafc; border: 1px solid var(--border); padding: 12px 20px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
    .guru-profile { display: flex; align-items: center; gap: 10px; cursor: pointer; }
    .guru-profile img { width: 40px; height: 40px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .banner { text-align:center; padding:12px; border-radius:12px; margin-bottom:25px; background: #eff6ff; border: 1px solid #dbeafe; color: var(--primary); font-weight: 700; font-size: 0.8rem; }
    
    .grid-siswa { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
    .card-siswa { background: #fff; border: 1px solid var(--border); padding: 15px 5px; border-radius: 20px; text-align: center; cursor: pointer; min-height: 140px; display: flex; flex-direction: column; justify-content: center; }

    .panel-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; overflow-y: auto; padding: 25px 15px; }
    .btn-action { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; margin-top: 10px; }
    input, textarea, select { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border); margin: 8px 0; outline: none; }

    /* CBT NAVIGASI NOMOR */
    .cbt-container { background: #f8fafc; padding: 20px; border-radius: 20px; border: 1px solid var(--border); }
    .nomor-grid { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; justify-content: center; }
    .nomor-box { width: 35px; height: 35px; border-radius: 8px; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 0.8rem; font-weight: 700; background: white; }
    .nomor-box.aktif { background: var(--primary); color: white; border-color: var(--primary); }
    .nomor-box.isi { background: #e0f2fe; border-color: var(--primary); color: var(--primary); }

    .opt-btn { background: white; border: 1px solid var(--border); padding: 12px; border-radius: 10px; margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; }
    .opt-btn.selected { background: var(--primary); color: white; }

    table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
    th { background: #f8fafc; padding: 12px; text-align: left; }
    td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
  </style>
</head>
<body>

<div class="container">
  <div class="brand-header"><h1>RUANG BELAJAR</h1><p>SD NEGERI PENGKOL</p></div>
  <div class="info-bar">
    <div style="font-size: 0.65rem; color: #64748b; font-weight: 600;">KELAS V ‚Ä¢ 2025/2026</div>
    <div class="guru-profile" onclick="bukaModalLogin()"><img src="https://ui-avatars.com/api/?name=Aditya+WW&background=2563eb&color=fff"></div>
  </div>
  <div id="statusTugas" class="banner">Memuat data...</div>
  <div class="grid-siswa" id="gridSiswa"></div>
</div>

<div id="panelGuru" class="panel-overlay">
  <div class="container" style="max-width: 400px; text-align:center;">
    <h2 style="margin-bottom: 25px;">Menu Kontrol</h2>
    <button class="btn-action" style="background:#f1f5f9;" onclick="tampilkanPanelBuat()">üìù Buat Tugas</button>
    <button class="btn-action" style="background:#f1f5f9;" onclick="tampilkanPanelRekap()">üìä Lihat Rekap</button>
    <button class="btn-action" style="background:#fee2e2; color:red" onclick="prosesHapusTugas()">üóëÔ∏è Hapus Tugas</button>
    <button class="btn-action" style="background:none;" onclick="location.reload()">Keluar</button>
  </div>
</div>

<div id="panelBuat" class="panel-overlay">
  <div class="container" style="max-width: 500px;">
    <h3>üìù Buat Tugas</h3>
    <input type="text" id="judulTugas" placeholder="Judul Materi">
    <select id="jenisTugas" onchange="resetWadahSoal()">
        <option value="pg">Pilihan Ganda (CBT)</option>
        <option value="uraian">Uraian / Esai</option>
    </select>
    <div id="wadahSoal"></div>
    <button class="btn-action" onclick="tambahSoal()">+ Tambah Soal</button>
    <button class="btn-action" style="background:var(--primary); color:white;" onclick="terbitkan()">TERBITKAN</button>
    <button class="btn-action" style="color:red" onclick="tutupSemua()">BATAL</button>
  </div>
</div>

<div id="panelSiswa" class="panel-overlay" style="background:#f0f2f5;">
  <div class="container" style="max-width: 600px;">
    <div class="nomor-grid" id="gridNomorCBT"></div>
    <div class="cbt-container">
        <p id="teksSoal" style="font-weight:700; margin-bottom:20px;"></p>
        <div id="wadahJawaban"></div>
    </div>
    <div style="display:flex; gap:10px; margin-top:15px;">
        <button class="btn-action" style="background:#fff;" onclick="nav(-1)">KEMBALI</button>
        <button class="btn-action" style="background:var(--primary); color:white;" onclick="nav(1)">LANJUT</button>
    </div>
    <button id="btnKirim" class="btn-action" style="background:#059669; color:white; display:none;" onclick="kirimJawaban()">KIRIM JAWABAN</button>
  </div>
</div>

<div id="panelRekap" class="panel-overlay">
  <div class="container">
    <h2 style="text-align:center;">üìä Rekap</h2>
    <table><thead><tr><th>No</th><th>Nama</th><th>Status</th><th>Aksi</th></tr></thead><tbody id="isiRekap"></tbody></table>
    <button class="btn-action" onclick="tutupSemua(); bukaPanelGuru();">KEMBALI</button>
  </div>
</div>

<div id="modalLogin" class="panel-overlay" style="display:none; align-items:center; justify-content:center;">
    <div style="width:300px; text-align:center;">
        <input type="password" id="pin" placeholder="PIN GURU" style="text-align:center;">
        <button class="btn-action" onclick="cekLogin()">MASUK</button>
    </div>
</div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzKSeF0P2w2x1sszm09pLl1lEzApYHH9xbG1UISa5SoiDWfrle5L4iF7jbh8LtdqgyHvA/exec";
const SISWA = [{n:"Alvaro Adnan Aji Pambudi",i:"üë¶"},{n:"Anantha Yudha Diztira",i:"üë¶"},{n:"Arifah Yhuan Nur Azizah",i:"üëß"},{n:"Aurelia Gieni Lindria Putri",i:"üëß"},{n:"Dhafitha Nizza Nur Azizah",i:"üëß"},{n:"Dhian Rahmawati",i:"üëß"},{n:"Dimas Rasyid Faristia",i:"üë¶"},{n:"Erfin Denu Setiawan",i:"üë¶"},{n:"Marsya Anindya Kiera",i:"üëß"},{n:"Mikayla Ayuningtyas",i:"üëß"},{n:"Muhammad Ozil Ramadhan",i:"üë¶"},{n:"Rhevan Nabil Yudanta",i:"üë¶"},{n:"Ridho Wicaksono",i:"üë¶"},{n:"Rizky Syam Dani",i:"üë¶"},{n:"Tanca Al Verosa",i:"üë¶"}];

let dataS = null, user = "", idx = 0, jwb = [];

window.onload = () => {
    const g = document.getElementById('gridSiswa');
    SISWA.forEach(s => g.innerHTML += `<div class="card-siswa" onclick="mulai('${s.n}')"><span>${s.i}</span><p>${s.n}</p></div>`);
    load();
};

async function load() {
    const r = await fetch(API + "?action=getAllData");
    dataS = await r.json();
    document.getElementById('statusTugas').innerText = dataS.tugas.judul;
}

// GURU - BUAT SOAL
function tambahSoal() {
    const id = Date.now();
    const jns = document.getElementById('jenisTugas').value;
    const div = document.createElement('div');
    div.id = id; div.style = "background:#f8fafc; padding:15px; border-radius:10px; margin-bottom:10px; position:relative; border:1px solid #ddd;";
    let h = `<button onclick="this.parentElement.remove()" style="position:absolute; right:10px; color:red; border:none; background:none;">Hapus</button>
             <b>Soal:</b><textarea class="q-t"></textarea>`;
    if(jns === 'pg') {
        h += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">
              <input class="q-a" placeholder="A"> <input class="q-b" placeholder="B">
              <input class="q-c" placeholder="C"> <input class="q-d" placeholder="D">
              </div>
              <small>Kunci Jawaban:</small>
              <select class="q-k"><option value="a">A</option><option value="b">B</option><option value="c">C</option><option value="d">D</option></select>`;
    }
    div.innerHTML = h;
    document.getElementById('wadahSoal').appendChild(div);
}

async function terbitkan() {
    const s = [];
    document.querySelectorAll('#wadahSoal > div').forEach(d => {
        let obj = {tanya: d.querySelector('.q-t').value};
        if(d.querySelector('.q-a')) {
            obj.a = d.querySelector('.q-a').value; obj.b = d.querySelector('.q-b').value;
            obj.c = d.querySelector('.q-c').value; obj.d = d.querySelector('.q-d').value;
            obj.kunci = d.querySelector('.q-k').value;
        }
        s.push(obj);
    });
    await fetch(API, {method:"POST", body:JSON.stringify({action:"setTugas", judul:document.getElementById('judulTugas').value, jenis:document.getElementById('jenisTugas').value, soal:s})});
    location.reload();
}

// SISWA - KERJA SOAL
function mulai(n) {
    if(!dataS || dataS.tugas.judul === "TIDAK ADA TUGAS") return alert("Belum ada tugas.");
    user = n; idx = 0; jwb = new Array(dataS.tugas.soal.length).fill("");
    document.getElementById('panelSiswa').style.display = 'block';
    renderCBT();
}

function renderCBT() {
    const s = dataS.tugas.soal[idx];
    const grid = document.getElementById('gridNomorCBT');
    grid.innerHTML = "";
    jwb.forEach((j, i) => {
        grid.innerHTML += `<div class="nomor-box ${idx === i ? 'aktif' : (j !== "" ? 'isi' : '')}" onclick="lompat(${i})">${i+1}</div>`;
    });

    document.getElementById('teksSoal').innerText = (idx+1) + ". " + s.tanya;
    const w = document.getElementById('wadahJawaban'); w.innerHTML = "";

    if(dataS.tugas.jenis === 'pg') {
        ['a','b','c','d'].forEach(o => {
            const b = document.createElement('div');
            b.className = `opt-btn ${jwb[idx] === o ? 'selected' : ''}`;
            b.innerHTML = `<b>${o.toUpperCase()}.</b> ${s[o]}`;
            b.onclick = () => { jwb[idx] = o; renderCBT(); };
            w.appendChild(b);
        });
    } else {
        const t = document.createElement('textarea'); t.value = jwb[idx];
        t.oninput = (e) => { jwb[idx] = e.target.value; renderCBT(); };
        w.appendChild(t);
    }
    document.getElementById('btnKirim').style.display = idx === jwb.length - 1 ? 'block' : 'none';
}

function lompat(i) { idx = i; renderCBT(); }
function nav(n) { if(idx+n >= 0 && idx+n < jwb.length) { idx += n; renderCBT(); } }

async function kirimJawaban() {
    if(!confirm("Kirim jawaban sekarang?")) return;
    document.getElementById('btnKirim').innerText = "Mengirim...";
    await fetch(API, {method:"POST", body:JSON.stringify({action:"upload", nama:user, materi:dataS.tugas.judul, nilai:jwb.join(", "), file:"-", filename:user+".txt"})});
    alert("Berhasil!"); location.reload();
}

// SISTEM LAINNYA
function bukaModalLogin() { document.getElementById('modalLogin').style.display = 'flex'; }
function cekLogin() { if(document.getElementById('pin').value === "1234") { tutupSemua(); document.getElementById('panelGuru').style.display = 'block'; } }
function tutupSemua() { document.querySelectorAll('.panel-overlay').forEach(p => p.style.display = 'none'); }
function tampilkanPanelBuat() { tutupSemua(); document.getElementById('panelBuat').style.display = 'block'; resetWadahSoal(); }
function resetWadahSoal() { document.getElementById('wadahSoal').innerHTML = ""; tambahSoal(); }
async function tampilkanPanelRekap() {
    tutupSemua(); document.getElementById('panelRekap').style.display = 'block';
    const tb = document.getElementById('isiRekap'); tb.innerHTML = "Loading...";
    await load(); tb.innerHTML = "";
    SISWA.forEach((s, i) => {
        const r = dataS.rekap.find(x => x.nama === s.n && x.materi === dataS.tugas.judul);
        tb.innerHTML += `<tr><td>${i+1}</td><td>${s.n}</td><td>${r?'Selesai':'-'}</td><td>${r?`<a href="https://drive.google.com/uc?id=${r.link}" target="_blank">Lihat</a>`:'-'}</td></tr>`;
    });
}
async function prosesHapusTugas() { if(confirm("Hapus?")) { await fetch(API, {method:"POST", body:JSON.stringify({action:"setTugas", judul:"TIDAK ADA TUGAS", soal:[]})}); location.reload(); } }
</script>
</body>
</html>
