<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS KELAS 5</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; padding: 15px; text-align: center; }
        .card { background: white; color: #333; padding: 20px; border-radius: 15px; max-width: 450px; margin: 15px auto; }
        input, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: #3b82f6; color: white; border: none; font-weight: bold; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <button onclick="bukaGuru()" id="btnGuru" style="position:fixed; top:10px; right:10px; width:auto; padding:5px 10px; font-size:11px;">Menu Guru</button>

    <div id="halamanSiswa">
        <div class="card">
            <h1 style="color:#0f172a">LMS Kelas 5</h1>
            <h2 id="topikTugas">Memuat...</h2>
            <a id="linkTugas" href="#" target="_blank" style="color:blue; font-weight:bold;">KLIK DI SINI UNTUK MATERI</a>
            <hr>
            <input type="text" id="namaSiswa" placeholder="Nama Lengkap">
            <input type="file" id="fileSiswa">
            <button onclick="kirimTugas()" style="background:#22c55e">KIRIM TUGAS</button>
        </div>
    </div>

    <div id="halamanGuru" class="hidden">
        <div class="card">
            <h2>Dashboard Guru</h2>
            <input type="text" id="setTopik" placeholder="Judul Tugas Baru">
            <input type="text" id="setLink" placeholder="Link Materi Baru">
            <button onclick="updateGuru()">Simpan & Perbarui Tugas</button>
            <hr>
            <h4>Progres Pengiriman Siswa:</h4>
            <table>
                <thead><tr><th>No</th><th>Nama</th><th>File</th></tr></thead>
                <tbody id="tabelSiswa"></tbody>
            </table>
            <button onclick="location.reload()" style="background:red; margin-top:10px;">Keluar</button>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxjE06Y6gs58Vq9TQ4dpGiTQ3rV_o2L4WacbfJi-P2xm4B-2blIpAvvrne6jsL0TQRWKg/exec'; // GANTI DENGAN LINK BARU

        function muatData() {
            fetch(scriptURL).then(r => r.json()).then(res => {
                document.getElementById('topikTugas').innerText = res.config.topik;
                document.getElementById('linkTugas').href = res.config.link;
                let html = "";
                res.data.forEach((r, i) => {
                    html += `<tr><td>${i+1}</td><td>${r[0]}</td><td><a href="${r[1]}" target="_blank">Lihat</a></td></tr>`;
                });
                document.getElementById('tabelSiswa').innerHTML = html || "<tr><td colspan='3'>Belum ada data</td></tr>";
            });
        }

        function bukaGuru() {
            if(prompt("Password:") === "1234") { // Password Guru
                document.getElementById('halamanSiswa').classList.add('hidden');
                document.getElementById('halamanGuru').classList.remove('hidden');
                document.getElementById('btnGuru').classList.add('hidden');
            }
        }

        function updateGuru() {
            const t = document.getElementById('setTopik').value;
            const l = document.getElementById('setLink').value;
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({type: "updateSettings", topik: t, link: l}) })
            .then(() => { alert("Berhasil!"); location.reload(); });
        }

        function kirimTugas() {
            const n = document.getElementById('namaSiswa').value;
            const f = document.getElementById('fileSiswa').files[0];
            const r = new FileReader();
            r.readAsDataURL(f);
            r.onload = function() {
                fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({type: "upload", nama: n, filename: f.name, fileData: r.result}) })
                .then(() => { alert("Terkirim!"); location.reload(); });
            };
        }

        muatData();
    </script>
</body>
</html>
