<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RUANG BELAJAR - SDN PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* CSS - Tampilan Website */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; padding: 20px; color: #f8fafc; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    .header { text-align: center; margin-bottom: 30px; }
    /* Style Logo Sekolah */
    .logo-sekolah { width: 100px; height: auto; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(56,189,248,0.4)); }
    
    .header h1 { font-size: 2.2rem; color: #38bdf8; letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 0 15px rgba(56,189,248,0.5); }
    .identitas-box { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; border: 1px dashed rgba(56,189,248,0.3); margin-bottom: 20px; }
    
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
    .student-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; backdrop-filter: blur(10px); }
    .student-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.1); border-color: #38bdf8; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    
    .student-icon { width: 65px; height: 65px; background: #1e293b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 2.5rem; border: 2px solid #38bdf8; }
    
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal { background: #1e293b; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 40px rgba(0,0,0,0.5); }
    .active { display: flex; }
    .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.2s; }
    .btn-primary { background: #38bdf8; color: #0f172a; }
    .btn-kuis { background: #f59e0b; color: #000; text-decoration: none; display: block; text-align: center; margin-bottom: 15px; }
    .btn-guru { background: transparent; border: 1px solid #38bdf8; color: #38bdf8; width: auto; padding: 8px 15px; margin-top: 10px; }
    
    .guru-panel { background: #ffffff; color: #1e293b; border-radius: 20px; padding: 25px; display: none; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; color: #333; font-size: 0.9rem; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }
    .status-ok { color: #10b981; font-weight: bold; }
    .status-no { color: #ef4444; font-weight: bold; }
    input[type="text"], input[type="password"] { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; font-size: 1rem; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <img src="https://lh3.googleusercontent.com/d/1XjSu50GinqKep-bRm4xr2_ITV_cOoPKi" class="logo-sekolah" alt="Logo SDN Pengkol">
    
    <h1>RUANG BELAJAR</h1>
    <div class="identitas-box">
        <p><strong>SD Negeri Pengkol</strong></p>
        <p>Kelas: 5 (Lima)</p>
        <p style="opacity: 0.8; font-size: 0.9rem;">Tahun Pelajaran 2025/2026</p>
    </div>
    <button class="btn btn-guru" onclick="bukaSandi()">Menu Guru</button>
  </div>

  <div id="studentView">
    <div style="text-align: center; margin-bottom: 25px; background: rgba(56,189,248,0.1); padding: 15px; border-radius: 15px; border: 1px solid rgba(56,189,248,0.2);">
        <p style="color: #38bdf8; font-size: 0.8rem; text-transform: uppercase; font-weight: bold;">Tugas Aktif:</p>
        <h2 id="displayTopik">Menghubungkan...</h2>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <div id="guruView" class="guru-panel">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Dashboard Guru</h2>
        <button class="btn btn-guru" style="border-color:#ccc; color:#666" onclick="location.reload()">Keluar</button>
    </div>
    <div style="margin: 15px 0;">
        <label>Nama Tugas:</label>
        <input type="text" id="setTopik" placeholder="Contoh: Kuis Matematika">
        <label>Link Materi/Kuis:</label>
        <input type="text" id="setLink" placeholder="Tempel link kuis di sini">
        <button class="btn btn-primary" onclick="simpanPengaturan()">SIMPAN & UPDATE</button>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead><tr><th>No</th><th>Nama Siswa</th><th>Status</th><th>Aksi</th></tr></thead>
            <tbody id="rekapBody"></tbody>
        </table>
    </div>
  </div>
</div>

<div class="modal-overlay" id="uploadModal">
  <div class="modal">
    <h3 id="modalSiswa">Nama Siswa</h3>
    <hr style="margin: 15px 0; opacity: 0.1;">
    <p style="font-size: 0.8rem; color: #94a3b8; margin-bottom: 10px;">Langkah 1: Kerjakan tugas di bawah</p>
    <a href="#" id="linkKuisSiswa" target="_blank" class="btn btn-kuis">üöÄ MULAI KERJAKAN TUGAS</a>
    <p style="font-size: 0.8rem; color: #94a3b8; margin-bottom: 10px;">Langkah 2: Upload foto/file bukti nilai</p>
    <input type="file" id="fileInput" multiple style="margin-bottom: 15px; color: white;">
    <button class="btn btn-primary" id="btnKirim" onclick="prosesUpload()">UPLOAD NILAI</button>
    <button class="btn" style="background:transparent; color:white; font-size: 0.8rem;" onclick="tutupModal()">Batal</button>
  </div>
</div>

<div class="modal-overlay" id="sandiModal">
  <div class="modal" style="max-width: 320px;">
    <h3>Sandi Guru</h3>
    <input type="password" id="passInput" placeholder="Sandi...">
    <button class="btn btn-primary" onclick="cekSandi()">Masuk</button>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupSandi()">Batal</button>
  </div>
</div>

<script>
  // Script Logic
  const scriptURL = "https://script.google.com/macros/s/AKfycbzMn1SBnS_K0P_DXVVWugsbAdCBq98iNAj4Bnungihi1HYDHm11x_np5meayW9o4Nhs3g/exec"; 

  const SISWA_DATA = [
    { nama: "Alvaro Adnan Aji Pambudi", ikon: "üë¶" },
    { nama: "Anantha Yudha Diztira", ikon: "üë¶" },
    { nama: "Arifah Yhuan Nur Azizah", ikon: "üëß" },
    { nama: "Aurelia Gieni Lindria Putri", ikon: "üëß" },
    { nama: "Dhafitha Nizza Nur Azizah", ikon: "üëß" },
    { nama: "Dhian Rahmawati", ikon: "üëß" },
    { nama: "Dimas Rasyid Faristia", ikon: "üë¶" },
    { nama: "Erfin Denu Setiawan", ikon: "üë¶" },
    { nama: "Marsya Anindya Kiera", ikon: "üëß" },
    { nama: "Mikayla Ayuningtyas", ikon: "üëß" },
    { nama: "Muhammad Ozil Ramadhan", ikon: "üë¶" },
    { nama: "Rhevan Nabil Yudanta", ikon: "üë¶" },
    { nama: "Ridho Wicaksono", ikon: "üë¶" },
    { nama: "Rizky Syam Dani", ikon: "üë¶" },
    { nama: "Tanca Al Verosa", ikon: "üë¶" }
  ];
  
  let topikAktif = "Memuat...";
  let linkAktif = "#";
  let siswaTerpilih = "";

  function muatPengaturan() {
    fetch(scriptURL + "?action=getSettings")
    .then(r => r.json())
    .then(settings => {
      topikAktif = settings.topik || "Tugas Belum Diatur";
      linkAktif = settings.link || "#";
      document.getElementById('displayTopik').innerText = topikAktif;
      document.getElementById('setTopik').value = topikAktif;
      document.getElementById('setLink').value = linkAktif;
    });
  }

  const grid = document.getElementById('cardsGrid');
  SISWA_DATA.forEach(s => {
    grid.innerHTML += `
      <div class="student-card" onclick="bukaUpload('${s.nama}')">
        <div class="student-icon">${s.ikon}</div>
        <div style="font-size:0.8rem; font-weight:bold; line-height:1.2;">${s.nama}</div>
      </div>`;
  });

  function bukaUpload(nama) {
    siswaTerpilih = nama;
    document.getElementById('modalSiswa').innerText = nama;
    document.getElementById('linkKuisSiswa').href = linkAktif;
    document.getElementById('uploadModal').classList.add('active');
  }

  function tutupModal() { document.getElementById('uploadModal').classList.remove('active'); }
  function bukaSandi() { document.getElementById('sandiModal').classList.add('active'); }
  function tutupSandi() { document.getElementById('sandiModal').classList.remove('active'); }

  function cekSandi() {
    if(document.getElementById('passInput').value === "guru123") {
        tutupSandi();
        document.getElementById('studentView').style.display = "none";
        document.getElementById('guruView').style.display = "block";
        muatRekap();
    } else { alert("Sandi Salah!"); }
  }

  function simpanPengaturan() {
    const t = document.getElementById('setTopik').value;
    const l = document.getElementById('setLink').value;
    if(!t || !l) return alert("Isi semua data!");
    fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ action: "setSettings", topik: t, link: l })
    }).then(() => {
      alert("Berhasil Update!");
      location.reload();
    });
  }

  async function prosesUpload() {
    const files = document.getElementById('fileInput').files;
    if(files.length === 0) return alert("Pilih file bukti!");
    const btn = document.getElementById('btnKirim');
    btn.innerText = "Mengirim..."; btn.disabled = true;

    let filePromises = Array.from(files).map(file => {
      return new Promise((resolve) => {
        let fr = new FileReader();
        fr.readAsDataURL(file);
        fr.onload = (e) => resolve({
          base64: e.target.result.split(",")[1],
          type: file.type,
          name: siswaTerpilih + " - " + file.name
        });
      });
    });

    const allFiles = await Promise.all(filePromises);
    fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ action: "upload", siswa: siswaTerpilih, topik: topikAktif, files: allFiles })
    }).then(() => { alert("Nilai Berhasil Ter-upload!"); tutupModal(); }).finally(() => { btn.innerText = "UPLOAD NILAI"; btn.disabled = false; });
  }

  function muatRekap() {
    const tbody = document.getElementById('rekapBody');
    tbody.innerHTML = "<tr><td colspan='4'>Memuat data...</td></tr>";
    fetch(scriptURL)
    .then(r => r.json())
    .then(data => {
      tbody.innerHTML = "";
      SISWA_DATA.forEach((s, i) => {
        const kiriman = data.filter(d => d[1] === s.nama && d[4] === topikAktif);
        const sudah = kiriman.length > 0;
        tbody.innerHTML += `<tr>
          <td>${i+1}</td>
          <td>${s.nama}</td>
          <td class="${sudah ? 'status-ok' : 'status-no'}">${sudah ? '‚úÖ Sudah' : '‚ùå Belum'}</td>
          <td>${sudah ? `<a href="https://drive.google.com/open?id=${kiriman[0][3]}" target="_blank" style="color:#38bdf8">Lihat Nilai</a>` : '-'}</td>
        </tr>`;
      });
    });
  }

  muatPengaturan();
</script>
</body>
</html>
