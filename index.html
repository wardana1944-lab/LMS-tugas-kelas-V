<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LMS KELAS 5 - SDN PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; padding: 20px; color: #f8fafc; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
    .student-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; }
    .student-card:hover { transform: translateY(-5px); background: rgba(255,255,255,0.1); border-color: #38bdf8; }
    .avatar { width: 50px; height: 50px; background: #38bdf8; color: #0f172a; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px; font-weight: bold; font-size: 1.2rem; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal { background: #1e293b; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; border: 1px solid rgba(255,255,255,0.1); }
    .active { display: flex; }
    .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
    .btn-primary { background: #38bdf8; color: #0f172a; }
    .btn-kuis { background: #f59e0b; color: #000; text-decoration: none; display: block; text-align: center; margin-bottom: 10px; }
    .btn-guru { background: transparent; border: 1px solid #38bdf8; color: #38bdf8; width: auto; padding: 8px 15px; }
    .guru-panel { background: #ffffff; color: #1e293b; border-radius: 20px; padding: 25px; display: none; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; color: #333; font-size: 0.9rem; }
    th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }
    .status-ok { color: #10b981; font-weight: bold; }
    .status-no { color: #ef4444; font-weight: bold; }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>LMS Kelas 5</h1>
    <button class="btn btn-guru" onclick="bukaSandi()">Menu Guru</button>
  </div>

  <div id="studentView">
    <div style="text-align: center; margin-bottom: 25px; background: rgba(56,189,248,0.1); padding: 15px; border-radius: 15px;">
        <p style="color: #38bdf8; font-size: 0.8rem;">Tugas Aktif:</p>
        <h2 id="displayTopik">Memuat Judul...</h2>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <div id="guruView" class="guru-panel">
    <div style="display: flex; justify-content: space-between;">
        <h2>Dashboard Guru</h2>
        <button onclick="location.reload()">Keluar</button>
    </div>
    <div style="margin: 15px 0; display: grid; gap: 10px;">
        <input type="text" id="setTopik" placeholder="Nama Tugas">
        <input type="text" id="setLink" placeholder="Link Canva / Materi">
        <button class="btn btn-primary" onclick="simpanPengaturan()">Simpan Pengaturan</button>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead><tr><th>No</th><th>Nama Siswa</th><th>Status</th><th>File</th></tr></thead>
            <tbody id="rekapBody"></tbody>
        </table>
    </div>
  </div>
</div>

<div class="modal-overlay" id="uploadModal">
  <div class="modal">
    <h3 id="modalSiswa">Nama Siswa</h3>
    <hr style="margin: 15px 0; opacity: 0.1;">
    <a href="#" id="linkKuisSiswa" target="_blank" class="btn btn-kuis">ðŸš€ MULAI KERJAKAN TUGAS</a>
    <input type="file" id="fileInput" multiple style="margin-bottom: 15px; color: white;">
    <button class="btn btn-primary" id="btnKirim" onclick="prosesUpload()">KIRIM JAWABAN</button>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupModal()">Batal</button>
  </div>
</div>

<div class="modal-overlay" id="sandiModal">
  <div class="modal" style="max-width: 300px;">
    <h3>Sandi Guru</h3>
    <input type="password" id="passInput" style="width:100%; padding:10px; margin:15px 0;">
    <button class="btn btn-primary" onclick="cekSandi()">Masuk</button>
    <button class="btn" onclick="tutupSandi()">Batal</button>
  </div>
</div>

<script>
  // PENTING: TEMPEL URL WEB APP BAPAK DI SINI
  const scriptURL = "https://script.google.com/macros/s/AKfycbw_PWTzPsAo5EptweteOVVKT2j_kVU4LE4BgFf_LNxLYUEfwi-H5a-Kl_bTB7SzVqGwUw/exec"; 

  const SISWA = ["Alvaro Adnan Aji Pambudi", "Anantha Yudha Diztira", "Arifah Yhuan Nur Azizah", "Aurelia Gieni Lindria Putri", "Dhafitha Nizza Nur Azizah", "Dhian Rahmawati", "Dimas Rasyid Faristia", "Erfin Denu Setiawan", "Marsya Anindya Kiera", "Mikayla Ayuningtyas", "Muhammad Ozil Ramadhan", "Rhevan Nabil Yudanta", "Ridho Wicaksono", "Rizky Syam Dani", "Tanca Al Verosa"];
  
  let topikAktif = localStorage.getItem("topikLMS") || "Tugas Belum Diatur";
  let linkAktif = localStorage.getItem("linkLMS") || "#";
  let siswaTerpilih = "";

  document.getElementById('displayTopik').innerText = topikAktif;
  document.getElementById('setTopik').value = topikAktif;
  document.getElementById('setLink').value = linkAktif;

  const grid = document.getElementById('cardsGrid');
  SISWA.forEach(s => {
    grid.innerHTML += `<div class="student-card" onclick="bukaUpload('${s}')"><div class="avatar">${s[0]}</div><div style="font-size:0.75rem">${s}</div></div>`;
  });

  function bukaUpload(nama) {
    siswaTerpilih = nama;
    document.getElementById('modalSiswa').innerText = nama;
    document.getElementById('linkKuisSiswa').href = linkAktif;
    document.getElementById('uploadModal').classList.add('active');
  }

  function tutupModal() { document.getElementById('uploadModal').classList.remove('active'); }
  function bukaSandi() { document.getElementById('sandiModal').classList.add('active'); }
  function tutupSandi() { document.getElementById('sandiModal').classList.remove('active'); }

  function cekSandi() {
    if(document.getElementById('passInput').value === "guru123") {
        tutupSandi();
        document.getElementById('studentView').style.display = "none";
        document.getElementById('guruView').style.display = "block";
        muatRekap();
    } else { alert("Sandi Salah!"); }
  }

  function simpanPengaturan() {
    localStorage.setItem("topikLMS", document.getElementById('setTopik').value);
    localStorage.setItem("linkLMS", document.getElementById('setLink').value);
    alert("Tugas Diperbarui!");
    location.reload();
  }

  async function prosesUpload() {
    const files = document.getElementById('fileInput').files;
    if(files.length === 0) return alert("Pilih file bukti!");
    const btn = document.getElementById('btnKirim');
    btn.innerText = "Mengirim..."; btn.disabled = true;

    let filePromises = Array.from(files).map(file => {
      return new Promise((resolve) => {
        let fr = new FileReader();
        fr.readAsDataURL(file);
        fr.onload = (e) => resolve({
          base64: e.target.result.split(",")[1],
          type: file.type,
          name: siswaTerpilih + " - " + file.name
        });
      });
    });

    const allFiles = await Promise.all(filePromises);
    fetch(scriptURL, {
      method: "POST",
      body: JSON.stringify({ siswa: siswaTerpilih, topik: topikAktif, files: allFiles })
    }).then(() => { alert("Terkirim!"); tutupModal(); }).finally(() => { btn.innerText = "KIRIM JAWABAN"; btn.disabled = false; });
  }

  function muatRekap() {
    const tbody = document.getElementById('rekapBody');
    tbody.innerHTML = "Memuat data...";
    fetch(scriptURL).then(r => r.json()).then(data => {
      tbody.innerHTML = "";
      SISWA.forEach((s, i) => {
        const kiriman = data.filter(d => d[1] === s && d[4] === topikAktif);
        const sudah = kiriman.length > 0;
        tbody.innerHTML += `<tr>
          <td>${i+1}</td>
          <td>${s}</td>
          <td class="${sudah ? 'status-ok' : 'status-no'}">${sudah ? 'Sudah' : 'Belum'}</td>
          <td>${sudah ? `<a href="https://drive.google.com/open?id=${kiriman[0][3]}" target="_blank">Lihat</a>` : '-'}</td>
        </tr>`;
      });
    });
  }
</script>
</body>
</html>
