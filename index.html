<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LMS KELAS 5</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; margin: 0; padding: 20px; text-align: center; }
        .card { background: white; color: #333; padding: 25px; border-radius: 20px; max-width: 450px; margin: 20px auto; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .btn { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-green { background: #10b981; color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        .btn-menu { position: absolute; top: 20px; right: 20px; width: auto; padding: 8px 15px; font-size: 12px; }
        input { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <button class="btn btn-blue btn-menu" id="btnMode" onclick="togleGuru()">Menu Guru</button>

    <div id="halamanSiswa">
        <div class="card">
            <h1 style="margin-top:0">LMS Kelas 5</h1>
            <h2 id="displayTopik">Memuat Judul...</h2>
            <a id="displayLink" href="#" target="_blank" style="color:#3b82f6; text-decoration:none; font-weight:bold;">KLIK DI SINI UNTUK MATERI</a>
            <hr style="margin:20px 0">
            <h3>Kumpul Tugas</h3>
            <input type="text" id="namaSiswa" placeholder="Nama Lengkap">
            <input type="file" id="fileSiswa">
            <button class="btn btn-green" onclick="kirimTugas()">KIRIM TUGAS</button>
        </div>
    </div>

    <div id="halamanGuru" class="hidden">
        <div class="card">
            <h2>Dashboard Guru</h2>
            <input type="text" id="setTopik" placeholder="Nama Tugas Baru">
            <input type="text" id="setLink" placeholder="Link Materi Baru">
            <button class="btn btn-blue" onclick="updateGuru()">Simpan & Perbarui</button>
            <hr>
            <h4>Rekapitulasi Tugas Siswa</h4>
            <table>
                <thead><tr><th>No</th><th>Nama Siswa</th><th>File</th></tr></thead>
                <tbody id="tabelSiswa"></tbody>
            </table>
            <button class="btn" style="background:#ef4444; color:white;" onclick="location.reload()">Keluar</button>
        </div>
    </div>

    <script>
        // GANTI DENGAN LINK /exec DARI GOOGLE APPS SCRIPT BAPAK
        const scriptURL = 'https://script.google.com/macros/s/AKfycbzMn1SBnS_K0P_DXVVWugsbAdCBq98iNAj4Bnungihi1HYDHm11x_np5meayW9o4Nhs3g/exec';
        let dataSiswaGlobal = [];

        function muatData() {
            fetch(scriptURL).then(r => r.json()).then(res => {
                document.getElementById('displayTopik').innerText = res.config.topik;
                document.getElementById('displayLink').href = res.config.link;
                dataSiswaGlobal = res.data;
                renderTabel();
            });
        }

        function renderTabel() {
            let h = "";
            dataSiswaGlobal.forEach((r, i) => {
                h += `<tr><td>${i+1}</td><td>${r[0]}</td><td><a href="${r[1]}" target="_blank">Lihat</a></td></tr>`;
            });
            document.getElementById('tabelSiswa').innerHTML = h || "<tr><td colspan='3'>Belum ada data</td></tr>";
        }

        function togleGuru() {
            let pass = prompt("Masukkan Password Guru:");
            if (pass === "1234") {
                document.getElementById('halamanSiswa').classList.add('hidden');
                document.getElementById('halamanGuru').classList.remove('hidden');
                document.getElementById('btnMode').style.display = 'none';
            } else { alert("Password Salah!"); }
        }

        function updateGuru() {
            const t = document.getElementById('setTopik').value;
            const l = document.getElementById('setLink').value;
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({type: "updateSettings", topik: t, link: l}) })
            .then(() => { alert("Berhasil Diperbarui!"); location.reload(); });
        }

        function kirimTugas() {
            const n = document.getElementById('namaSiswa').value;
            const f = document.getElementById('fileSiswa').files[0];
            if(!n || !f) return alert("Isi Nama & File!");
            const r = new FileReader();
            r.readAsDataURL(f);
            r.onload = function() {
                fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({type: "upload", nama: n, filename: f.name, fileData: r.result}) })
                .then(() => { alert("Tugas Terkirim!"); location.reload(); });
            };
        }
        muatData();
    </script>
</body>
</html>
