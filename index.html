<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RUANG BELAJAR - SDN PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; padding: 20px; color: #f8fafc; position: relative; }
    .container { max-width: 1000px; margin: 0 auto; }
    
    /* Logo Pojok Kanan Atas - Memanggil dari GitHub Repo */
    .logo-sekolah { 
      position: absolute; 
      top: 20px; 
      right: 20px; 
      width: 70px; 
      height: auto; 
      z-index: 10;
    }

    .header { text-align: center; margin-bottom: 30px; padding-top: 10px; }
    .header h1 { font-size: 2.2rem; color: #38bdf8; letter-spacing: 2px; margin-bottom: 15px; text-shadow: 0 0 15px rgba(56,189,248,0.5); }
    
    .identitas-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px dashed rgba(56,189,248,0.3); margin-bottom: 15px; }
    
    .guru-profile-box { 
      background: rgba(56,189,248,0.1); 
      padding: 20px; 
      border-radius: 20px; 
      border: 1px solid rgba(56,189,248,0.2); 
      margin: 0 auto 30px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      text-align: left;
      max-width: 450px;
    }
    .foto-guru {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      border: 3px solid #38bdf8;
      object-fit: cover;
      background: #334155;
    }
    .guru-info p { margin: 0; font-size: 0.85rem; opacity: 0.9; }
    .guru-nama { font-weight: bold; color: #38bdf8; font-size: 1.1rem !important; }

    .btn-guru-menu { 
      background: rgba(56,189,248,0.2); 
      border: 1px solid #38bdf8; 
      color: #38bdf8; 
      padding: 5px 12px; 
      font-size: 0.75rem; 
      cursor: pointer; 
      border-radius: 6px; 
      margin-top: 8px;
      font-weight: 600;
    }

    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
    .student-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 20px; text-align: center; cursor: pointer; transition: 0.3s; }
    .student-icon { width: 65px; height: 65px; background: #1e293b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 2.5rem; border: 2px solid #38bdf8; }

    /* Modal Styles */
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal { background: #1e293b; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px; border: 1px solid rgba(255,255,255,0.1); }
    .active { display: flex; }
    .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
    .btn-primary { background: #38bdf8; color: #0f172a; }
    .btn-kuis { background: #f59e0b; color: #000; text-decoration: none; display: block; text-align: center; margin-bottom: 15px; }
    
    .guru-panel { background: #ffffff; color: #1e293b; border-radius: 20px; padding: 25px; display: none; margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; color: #333; font-size: 0.9rem; }
    th, td { padding: 12px; border-bottom: 1px solid #ddd; text-align: left; }

    @media (max-width: 600px) {
      .logo-sekolah { position: static; display: block; margin: 0 auto 15px; width: 60px; }
    }
  </style>
</head>
<body>

<img src="logo putih.png" class="logo-sekolah" alt="Logo Sekolah">

<div class="container">
  <div class="header">
    <h1>RUANG BELAJAR</h1>
    <div class="identitas-box">
        <p><strong>SD Negeri Pengkol</strong></p>
        <p>Kelas: 5 (Lima) | Tahun Pelajaran 2025/2026</p>
    </div>

    <div class="guru-profile-box">
        <img src="foto-guru.jpg" class="foto-guru" alt="Aditya Wahyu Wardana">
        <div class="guru-info">
            <p class="guru-nama">Aditya Wahyu Wardana, S.Pd</p>
            <p>NIP. 199403192023211005</p>
            <p>Wali Kelas V</p>
            <button class="btn-guru-menu" onclick="bukaSandi()">‚öôÔ∏è Menu Guru</button>
        </div>
    </div>
  </div>

  <div id="studentView">
    <div style="text-align: center; margin-bottom: 25px; background: rgba(56,189,248,0.1); padding: 15px; border-radius: 15px; border: 1px solid rgba(56,189,248,0.2);">
        <p style="color: #38bdf8; font-size: 0.8rem; text-transform: uppercase; font-weight: bold;">Tugas Aktif:</p>
        <h2 id="displayTopik">Memuat...</h2>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <div id="guruView" class="guru-panel">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>Dashboard Guru</h2>
        <button onclick="location.reload()">Keluar</button>
    </div>
    <div style="margin: 15px 0;">
        <input type="text" id="setTopik" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="Nama Tugas">
        <input type="text" id="setLink" style="width:100%; padding:10px; margin-bottom:10px;" placeholder="Link Materi">
        <button class="btn btn-primary" onclick="simpanPengaturan()">SIMPAN & UPDATE</button>
    </div>
    <div style="overflow-x: auto;">
        <table>
            <thead><tr><th>No</th><th>Siswa</th><th>Status</th><th>Aksi</th></tr></thead>
            <tbody id="rekapBody"></tbody>
        </table>
    </div>
  </div>
</div>

<div class="modal-overlay" id="sandiModal">
  <div class="modal" style="max-width: 300px;">
    <h3>Sandi Guru</h3>
    <input type="password" id="passInput" style="width:100%; padding:10px; margin:10px 0;">
    <button class="btn btn-primary" onclick="cekSandi()">Masuk</button>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupSandi()">Batal</button>
  </div>
</div>

<div class="modal-overlay" id="uploadModal">
  <div class="modal">
    <h3 id="modalSiswa">Nama Siswa</h3>
    <hr style="margin: 15px 0; opacity: 0.1;">
    <a href="#" id="linkKuisSiswa" target="_blank" class="btn btn-kuis">üöÄ MULAI KERJAKAN TUGAS</a>
    <input type="file" id="fileInput" multiple style="margin-bottom: 10px; color:white;">
    <button class="btn btn-primary" id="btnKirim" onclick="prosesUpload()">UPLOAD NILAI</button>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupModal()">Batal</button>
  </div>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzMn1SBnS_K0P_DXVVWugsbAdCBq98iNAj4Bnungihi1HYDHm11x_np5meayW9o4Nhs3g/exec"; 
  const SISWA_DATA = [
    { nama: "Alvaro Adnan Aji Pambudi", ikon: "üë¶" }, { nama: "Anantha Yudha Diztira", ikon: "üë¶" },
    { nama: "Arifah Yhuan Nur Azizah", ikon: "üëß" }, { nama: "Aurelia Gieni Lindria Putri", ikon: "üëß" },
    { nama: "Dhafitha Nizza Nur Azizah", ikon: "üëß" }, { nama: "Dhian Rahmawati", ikon: "üëß" },
    { nama: "Dimas Rasyid Faristia", ikon: "üë¶" }, { nama: "Erfin Denu Setiawan", ikon: "üë¶" },
    { nama: "Marsya Anindya Kiera", ikon: "üëß" }, { nama: "Mikayla Ayuningtyas", ikon: "üëß" },
    { nama: "Muhammad Ozil Ramadhan", ikon: "üë¶" }, { nama: "Rhevan Nabil Yudanta", ikon: "üë¶" },
    { nama: "Ridho Wicaksono", ikon: "üë¶" }, { nama: "Rizky Syam Dani", ikon: "üë¶" },
    { nama: "Tanca Al Verosa", ikon: "üë¶" }
  ];
  
  let topikAktif = ""; let linkAktif = ""; let siswaTerpilih = "";
  function muatPengaturan() { fetch(scriptURL + "?action=getSettings").then(r => r.json()).then(s => { topikAktif = s.topik; linkAktif = s.link; document.getElementById('displayTopik').innerText = topikAktif; }); }
  const grid = document.getElementById('cardsGrid');
  SISWA_DATA.forEach(s => { grid.innerHTML += `<div class="student-card" onclick="bukaUpload('${s.nama}')"><div class="student-icon">${s.ikon}</div><div style="font-size:0.8rem; font-weight:bold;">${s.nama}</div></div>`; });
  function bukaUpload(n) { siswaTerpilih = n; document.getElementById('modalSiswa').innerText = n; document.getElementById('linkKuisSiswa').href = linkAktif; document.getElementById('uploadModal').classList.add('active'); }
  function tutupModal() { document.getElementById('uploadModal').classList.remove('active'); }
  function bukaSandi() { document.getElementById('sandiModal').classList.add('active'); }
  function tutupSandi() { document.getElementById('sandiModal').classList.remove('active'); }
  function cekSandi() { if(document.getElementById('passInput').value === "guru123") { tutupSandi(); document.getElementById('studentView').style.display = "none"; document.getElementById('guruView').style.display = "block"; muatRekap(); } else { alert("Sandi Salah!"); } }
  function simpanPengaturan() { fetch(scriptURL, { method: "POST", body: JSON.stringify({ action: "setSettings", topik: document.getElementById('setTopik').value, link: document.getElementById('setLink').value }) }).then(() => location.reload()); }
  async function prosesUpload() {
    const files = document.getElementById('fileInput').files; if(files.length === 0) return alert("Pilih file!");
    const btn = document.getElementById('btnKirim'); btn.innerText = "Mengirim..."; btn.disabled = true;
    let filePromises = Array.from(files).map(f => new Promise((resolve) => { let fr = new FileReader(); fr.readAsDataURL(f); fr.onload = (e) => resolve({ base64: e.target.result.split(",")[1], type: f.type, name: siswaTerpilih + " - " + f.name }); }));
    const allFiles = await Promise.all(filePromises);
    fetch(scriptURL, { method: "POST", body: JSON.stringify({ action: "upload", siswa: siswaTerpilih, topik: topikAktif, files: allFiles }) }).then(() => { alert("Berhasil!"); tutupModal(); }).finally(() => { btn.innerText = "UPLOAD NILAI"; btn.disabled = false; });
  }
  function muatRekap() {
    const tbody = document.getElementById('rekapBody');
    fetch(scriptURL).then(r => r.json()).then(data => {
      tbody.innerHTML = "";
      SISWA_DATA.forEach((s, i) => {
        const kiriman = data.filter(d => d[1] === s.nama && d[4] === topikAktif); const sudah = kiriman.length > 0;
        tbody.innerHTML += `<tr><td>${i+1}</td><td>${s.nama}</td><td style="color:${sudah ? '#10b981' : '#ef4444'}">${sudah ? 'Sudah' : 'Belum'}</td><td>${sudah ? `<a href="https://drive.google.com/open?id=${kiriman[0][3]}" target="_blank">Lihat</a>` : '-'}</td></tr>`;
      });
    });
  }
  muatPengaturan();
</script>
</body>
</html>