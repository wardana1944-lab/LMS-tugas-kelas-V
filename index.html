<!doctype html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RUANG BELAJAR - SDN PENGKOL</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* CSS & Tampilan */
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); min-height: 100vh; padding: 20px; color: #f8fafc; }
    .container { max-width: 1000px; margin: 0 auto; position: relative; }
    
    /* UKURAN LOGO DIPERKECIL DISINI */
    .logo-sekolah { position: absolute; top: 0; left: 0; width: 50px; height: auto; opacity: 0.9; }
    
    .header-main { text-align: center; margin-bottom: 30px; padding-top: 10px; }
    .header-main h1 { font-size: 2.2rem; color: #38bdf8; letter-spacing: 2px; margin-bottom: 15px; text-shadow: 0 0 15px rgba(56,189,248,0.5); }
    .identitas-box { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 15px; border: 1px dashed rgba(56,189,248,0.3); margin-bottom: 15px; }
    .guru-profile-box { background: rgba(56,189,248,0.1); padding: 20px; border-radius: 20px; border: 1px solid rgba(56,189,248,0.2); margin: 0 auto 30px auto; display: flex; align-items: center; justify-content: center; gap: 20px; text-align: left; max-width: 450px; }
    .foto-guru { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #38bdf8; object-fit: cover; }
    .btn-guru-menu { background: rgba(56,189,248,0.2); border: 1px solid #38bdf8; color: #38bdf8; padding: 5px 12px; font-size: 0.75rem; cursor: pointer; border-radius: 6px; margin-top: 8px; font-weight: 600; }
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
    .student-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 25px 15px 15px 15px; text-align: center; cursor: pointer; transition: 0.3s; position: relative; overflow: hidden; }
    .status-badge { position: absolute; top: 0; right: 0; padding: 3px 8px; font-size: 0.6rem; font-weight: bold; border-bottom-left-radius: 10px; text-transform: uppercase; }
    .status-belum { background: #ef4444; color: white; }
    .status-sudah { background: #10b981; color: white; }
    .student-icon { width: 60px; height: 60px; background: #1e293b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; font-size: 2.2rem; border: 2px solid #38bdf8; }
    #halamanGuru { display: none; background: #ffffff; color: #1e293b; border-radius: 20px; padding: 25px; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; color: #333; font-size: 0.85rem; }
    th { background: #38bdf8; color: white; padding: 12px; text-align: left; }
    td { padding: 10px; border-bottom: 1px solid #eee; }
    input[type="text"], input[type="password"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 10px; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 100; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
    .modal { background: #1e293b; padding: 30px; border-radius: 20px; width: 90%; max-width: 450px; border: 1px solid rgba(255,255,255,0.1); }
    .active { display: flex; }
    .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; cursor: pointer; font-weight: bold; margin-top: 10px; }
    .btn-primary { background: #38bdf8; color: #0f172a; }
    .btn-danger { background: #ef4444; color: white; }
    .btn-kuis { background: #f59e0b; color: #000; text-decoration: none; display: block; text-align: center; margin-bottom: 15px; border-radius: 10px; padding: 10px; }
  </style>
</head>
<body>
<div class="container">
  <div id="halamanDepan">
    <img src="logo-putih.png" class="logo-sekolah" alt="Logo">
    <div class="header-main">
      <h1>RUANG BELAJAR</h1>
      <div class="identitas-box">
          <p><strong>SD Negeri Pengkol</strong></p>
          <p>Kelas: 5 | Tahun Pelajaran 2025/2026</p>
      </div>
      <div class="guru-profile-box">
          <img src="foto-guru.webp" class="foto-guru" alt="Aditya">
          <div class="guru-info">
              <p style="font-weight:bold; color:#38bdf8;">Aditya Wahyu Wardana, S.Pd</p>
              <button class="btn-guru-menu" onclick="bukaSandi()">‚öôÔ∏è Log In Guru</button>
          </div>
      </div>
    </div>
    <div style="text-align: center; margin-bottom: 25px; background: rgba(56,189,248,0.1); padding: 15px; border-radius: 15px; border: 1px solid rgba(56,189,248,0.2);">
        <p style="color:#38bdf8; font-size:0.8rem; font-weight:bold;">TUGAS AKTIF:</p>
        <h2 id="displayTopik">Menghubungkan...</h2>
    </div>
    <div class="cards-grid" id="cardsGrid"></div>
  </div>

  <div id="halamanGuru">
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #38bdf8; padding-bottom: 15px; margin-bottom: 20px;">
        <h2 style="color: #0f172a;">üìä Dashboard Guru</h2>
        <button onclick="location.reload()" style="background:#64748b; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer;">Keluar</button>
    </div>
    <div style="background:#f8fafc; padding:15px; border:1px solid #e2e8f0; border-radius:12px; margin-bottom:25px;">
        <input type="text" id="setTopik" placeholder="Nama Tugas Baru">
        <input type="text" id="setLink" placeholder="Link Materi/Kuis">
        <button class="btn btn-primary" onclick="simpanPengaturan()">AKTIFKAN TUGAS</button>
        <button class="btn btn-danger" onclick="cutOffTugas()" style="margin-top:10px;">‚úÇÔ∏è CUT OFF TUGAS</button>
    </div>
    <div style="overflow-x: auto;">
        <table id="tabelRekap">
            <thead><tr><th>No</th><th>Siswa</th><th>Status</th><th>Bukti</th></tr></thead>
            <tbody id="rekapBody"></tbody>
        </table>
    </div>
  </div>
</div>

<div class="modal-overlay" id="sandiModal">
  <div class="modal" style="max-width:300px;">
    <h3 style="color:white; margin-bottom:15px;">Akses Guru</h3>
    <input type="password" id="passInput" placeholder="Sandi">
    <button class="btn btn-primary" onclick="cekSandi()">Masuk</button>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupSandi()">Batal</button>
  </div>
</div>

<div class="modal-overlay" id="uploadModal">
  <div class="modal">
    <h3 id="modalSiswa" style="color:#38bdf8;">Nama Siswa</h3>
    <hr style="margin:15px 0; opacity:0.1;">
    <div id="areaTugas">
        <a href="#" id="linkKuisSiswa" target="_blank" class="btn btn-kuis">üöÄ KERJAKAN TUGAS</a>
        <input type="file" id="fileInput" multiple style="color:white; margin-bottom:15px;">
        <button class="btn btn-primary" id="btnKirim" onclick="prosesUpload()">UPLOAD</button>
    </div>
    <div id="areaTutup" style="display:none; color:white; text-align:center;"><p>‚ö†Ô∏è Tugas ditutup.</p></div>
    <button class="btn" style="background:transparent; color:white;" onclick="tutupModal()">Tutup</button>
  </div>
</div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbzMn1SBnS_K0P_DXVVWugsbAdCBq98iNAj4Bnungihi1HYDHm11x_np5meayW9o4Nhs3g/exec"; 
  const SISWA_DATA = [
    { nama: "Alvaro Adnan Aji Pambudi", ikon: "üë¶" }, { nama: "Anantha Yudha Diztira", ikon: "üë¶" },
    { nama: "Arifah Yhuan Nur Azizah", ikon: "üëß" }, { nama: "Aurelia Gieni Lindria Putri", ikon: "üëß" },
    { nama: "Dhafitha Nizza Nur Azizah", ikon: "üëß" }, { nama: "Dhian Rahmawati", ikon: "üëß" },
    { nama: "Dimas Rasyid Faristia", ikon: "üë¶" }, { nama: "Erfin Denu Setiawan", ikon: "üë¶" },
    { nama: "Marsya Anindya Kiera", ikon: "üëß" }, { nama: "Mikayla Ayuningtyas", ikon: "üëß" },
    { nama: "Muhammad Ozil Ramadhan", ikon: "üë¶" }, { nama: "Rhevan Nabil Yudanta", ikon: "üë¶" },
    { nama: "Ridho Wicaksono", ikon: "üë¶" }, { nama: "Rizky Syam Dani", ikon: "üë¶" },
    { nama: "Tanca Al Verosa", ikon: "üë¶" }
  ];
  
  let topikAktif = ""; let linkAktif = ""; let siswaTerpilih = "";

  const grid = document.getElementById('cardsGrid');
  SISWA_DATA.forEach(s => { 
    grid.innerHTML += `<div class="student-card" onclick="bukaUpload('${s.nama}')">
        <div class="status-badge" id="badge-${s.nama.replace(/\s+/g, '')}">...</div>
        <div class="student-icon">${s.ikon}</div>
        <div style="font-size:0.75rem; font-weight:bold;">${s.nama}</div>
    </div>`; 
  });

  async function muatDataUtama() { 
    const res = await fetch(scriptURL + "?action=getSettings");
    const s = await res.json();
    topikAktif = s.topik; linkAktif = s.link;
    const isAda = (topikAktif && topikAktif !== "TIDAK ADA TUGAS");
    document.getElementById('displayTopik').innerText = isAda ? topikAktif : "TIDAK ADA TUGAS AKTIF";
    
    const resRekap = await fetch(scriptURL);
    const data = await resRekap.json();
    SISWA_DATA.forEach(siswa => {
      const badge = document.getElementById("badge-" + siswa.nama.replace(/\s+/g, ''));
      const sudah = data.some(d => d[1] === siswa.nama && d[4] === topikAktif);
      if(sudah && isAda) { badge.innerText="Selesai"; badge.className="status-badge status-sudah"; }
      else { badge.innerText="Belum"; badge.className="status-badge status-belum"; }
    });
  }

  function cutOffTugas() {
    if(confirm("Reset semua status menjadi BELUM?")) {
        fetch(scriptURL, { method:"POST", body:JSON.stringify({action:"setSettings", topik:"TIDAK ADA TUGAS", link:""}) }).then(() => location.reload());
    }
  }

  function muatRekapDashboard() {
    const tbody = document.getElementById('rekapBody');
    const isAda = (topikAktif && topikAktif !== "TIDAK ADA TUGAS");
    tbody.innerHTML = "<tr><td colspan='4' style='text-align:center'>Memuat...</td></tr>";
    fetch(scriptURL).then(r => r.json()).then(data => {
      tbody.innerHTML = "";
      SISWA_DATA.forEach((s, i) => {
        const kiriman = data.filter(d => d[1] === s.nama && d[4] === topikAktif);
        const sudah = kiriman.length > 0 && isAda;
        tbody.innerHTML += `<tr><td>${i+1}</td><td>${s.nama}</td>
            <td style="color:${sudah ? '#10b981' : '#ef4444'}; font-weight:bold;">${sudah ? '‚úÖ Selesai' : '‚ùå Belum'}</td>
            <td>${sudah ? `<a href="https://drive.google.com/open?id=${kiriman[0][3]}" target="_blank">Lihat</a>` : '-'}</td></tr>`;
      });
    });
  }

  function cekSandi() { if(document.getElementById('passInput').value === "guru123") { document.getElementById('halamanDepan').style.display="none"; document.getElementById('halamanGuru').style.display="block"; muatRekapDashboard(); tutupSandi(); } else { alert("Salah!"); } }
  function bukaSandi() { document.getElementById('sandiModal').classList.add('active'); }
  function tutupSandi() { document.getElementById('sandiModal').classList.remove('active'); }
  function bukaUpload(n) { 
    siswaTerpilih = n; document.getElementById('modalSiswa').innerText = n;
    const isAda = (topikAktif && topikAktif !== "TIDAK ADA TUGAS");
    document.getElementById('areaTugas').style.display = isAda ? "block" : "none";
    document.getElementById('areaTutup').style.display = isAda ? "none" : "block";
    if(isAda) document.getElementById('linkKuisSiswa').href = linkAktif;
    document.getElementById('uploadModal').classList.add('active'); 
  }
  function tutupModal() { document.getElementById('uploadModal').classList.remove('active'); }
  function simpanPengaturan() { fetch(scriptURL, { method:"POST", body:JSON.stringify({action:"setSettings", topik:document.getElementById('setTopik').value, link:document.getElementById('setLink').value}) }).then(() => location.reload()); }
  async function prosesUpload() {
    const files = document.getElementById('fileInput').files; if(files.length===0) return alert("Pilih file!");
    const btn = document.getElementById('btnKirim'); btn.innerText="Mengirim...";
    let filePromises = Array.from(files).map(f => new Promise((res) => { let fr = new FileReader(); fr.readAsDataURL(f); fr.onload = (e) => res({ base64: e.target.result.split(",")[1], type: f.type, name: siswaTerpilih + " - " + f.name }); }));
    const allFiles = await Promise.all(filePromises);
    fetch(scriptURL, { method:"POST", body:JSON.stringify({action:"upload", siswa:siswaTerpilih, topik:topikAktif, files:allFiles}) }).then(() => location.reload());
  }
  muatDataUtama();
</script>
</body>
</html>

